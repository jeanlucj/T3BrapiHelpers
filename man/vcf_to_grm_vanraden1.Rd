% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/VCFtoGRM_byChatGPT.R
\name{vcf_to_grm_vanraden1}
\alias{vcf_to_grm_vanraden1}
\title{Compute an additive genomic relationship matrix from a VCF using VanRaden I}
\usage{
vcf_to_grm_vanraden1(
  vcf_file,
  out_rds,
  gds_file = NULL,
  callrate_threshold = 0.9,
  maf_threshold = 0.01,
  block_size = 2000L,
  overwrite = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{vcf_file}{Character scalar. Path to an input VCF file (\code{.vcf} or
\code{.vcf.gz}) containing diploid, biallelic SNP genotypes in \code{GT}.}

\item{out_rds}{Character scalar. Output \code{.rds} filename to write using
\code{saveRDS()}.}

\item{gds_file}{Optional character scalar. Path to a temporary/permanent
\code{.gds} file to create. If \code{NULL}, a filename is derived from
\code{out_rds}.}

\item{callrate_threshold}{Numeric in (0,1]. SNP call rate threshold. SNPs
with call rate below this are removed. Default 0.90.}

\item{maf_threshold}{Numeric in \link{0,0.5}. Minor allele frequency threshold.
SNPs with MAF below this are removed. Default 0.01.}

\item{block_size}{Integer. Number of SNPs processed per block to reduce
memory usage. Default 2000.}

\item{overwrite}{Logical. If \code{TRUE}, overwrite any existing
\code{gds_file}. Default \code{TRUE}.}

\item{verbose}{Logical. Print progress messages. Default \code{TRUE}.}
}
\value{
Invisibly returns a list saved to \code{out_rds} containing:
\itemize{
\item \code{ids}: sample IDs (row/col order of \code{GRM})
\item \code{GRM}: additive genomic relationship matrix (VanRaden I)
\item \code{denom}: denominator \eqn{2\sum p(1-p)} used for scaling
\item \code{snps_used}: SNP IDs used after QC
\item \code{qc}: list of QC thresholds used
\item \code{gds_file}: path to the created GDS
}
}
\description{
This function reads a diploid, biallelic SNP VCF (optionally gzipped),
converts it to GDS using \code{SNPRelate}, applies basic SNP filtering, and
computes the additive genomic relationship matrix (GRM) using the VanRaden I
estimator:
}
\details{
\deqn{G = \frac{ZZ^\top}{2 \sum_j p_j (1-p_j)}}

where \eqn{Z_{ij} = x_{ij} - 2p_j}, \eqn{x_{ij}} is the ALT allele dosage
(0,1,2), and \eqn{p_j} is the ALT allele frequency at marker \eqn{j}. Missing
genotypes are implicitly imputed to \eqn{2p_j} so their centered contribution
is zero (i.e., missing \eqn{Z_{ij}} is set to 0).

The result is saved to \code{out_rds} via \code{saveRDS()} as a list with
fields including \code{ids} and \code{GRM}.
}
\keyword{internal}

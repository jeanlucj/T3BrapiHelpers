# Retry a Function Multiple Times on Error

`retryQuery()` repeatedly calls a user-supplied function that may throw
an error (e.g., due to network timeouts, temporary API failures, or file
I/O issues). If an error occurs, the function waits a specified number
of seconds and tries again, up to a user-defined maximum number of
attempts.

## Usage

``` r
retryQuery(fun, max_tries = 10, wait = 3, silent = TRUE)
```

## Arguments

- fun:

  A function of zero arguments (typically an anonymous function) that
  encapsulates the operation to attempt.

- max_tries:

  Integer. Maximum number of attempts before giving up. Default is 10.

- wait:

  Numeric. Number of seconds to pause between attempts. Default is 3.

- silent:

  Logical. Whether to suppress error messages from failed attempts.
  Default is `TRUE`.

## Value

The value returned by `fun()` if an attempt succeeds; otherwise `NULL`
invisibly.

## Details

This wrapper is especially useful for BrAPI queries or `httr` requests
that intermittently fail but typically succeed on a subsequent attempt.

The function supplied to `retry()` is evaluated in the environment where
`retry()` is called, so all local variables referenced inside the
function are automatically available. This is safer and more flexible
than evaluating quoted expressions.

### Behavior

- On the **first successful call**, the returned value is returned

- If all attempts fail, `NULL` is returned invisibly after a final
  message.

- Errors generated by failed attempts are suppressed when
  `silent = TRUE`.

## Examples

``` r
# A function that fails twice, then succeeds
i <- 0
result <- retry(
  function() {
    i <<- i + 1
    if (i < 3) stop("Temporary failure")
    "Success!"
  },
  max_tries = 5,
  wait = 0.1
)
#> Error in retry(function() {    i <<- i + 1    if (i < 3)         stop("Temporary failure")    "Success!"}, max_tries = 5, wait = 0.1): could not find function "retry"
result
#> Error: object 'result' not found

# Example with an httr call (fake for illustration)
t3url <- "https://example.org"
path <- "/endpoint"

fake_call <- function() {
  if (runif(1) < 0.7) stop("Simulated flaky network")
  paste("Called:", paste0(t3url, path))
}

retryQuery(fake_call, max_tries = 5, wait = 0.2)
#> Error in retryQuery(fake_call, max_tries = 5, wait = 0.2): could not find function "retryQuery"
```
